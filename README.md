# StatusPage Docker Image

This is the official repository of the [Docker image](https://github.com/BinhPhuongIT/statuspage-docker) for [StatusPage](https://github.com/BinhPhuongIT/statuspage).

[StatusPage](https://github.com/BinhPhuongIT/statuspage) is a beautiful and powerful open source status page system, a free replacement for services such as StatusPage.io, Status.io and others.

For full documentation, visit the [Installing StatusPage with Docker](https://docs.cachethq.io/docs/get-started-with-docker) page.

# Supporting StatusPage

StatusPage is a BSD-3-licensed open source project. If you'd like to support future development, check out the [StatusPage Patreon](https://patreon.com/jbrooksuk) campaign.

# Quickstart

1. Clone this repository

  ```shell
  git clone https://github.com/StatusPage/Docker.git
  ```

2. Edit the docker-compose.yml file to specify your [ENV variables](/conf/.env.docker).

__Note:__ You must specify a unique `APP_KEY` including `base64:` prefix generated by `php artisan key:generate` within the container.

3. To build an image containing a specific StatusPage release, set the [`cachet_ver` ARG in the docker-compose.yml](/docker-compose.yml)

  The *master* branch and *cachethq/docker:latest* Docker automated build are a work in progress / development version of the upstream https://github.com/BinhPhuongIT/statuspage project. As such, *master* or *latest* should not be used in a production environment as it can change at anytime.

  We strongly recommend specifying a stable [StatusPage Release](https://github.com/BinhPhuongIT/statuspage/releases) at build time as mentioned above.

4. Build and run the image

  ```shell
  docker-compose build
  docker-compose up
  ```

5. `cachethq/docker`  runs on port 8000 by default. This is exposed on host port 80 when using docker-compose.

# Docker Hub Automated build

`cachethq/docker` is available as a [Docker Hub Trusted Build](https://github.com/BinhPhuongIT/statuspage-docker).

For a full list of StatusPage versions released as Docker images  please see the [list of Docker hub tags](https://github.com/BinhPhuongIT/statuspage-dockertags/).

Please use a [tagged StatusPage Docker image release](https://github.com/StatusPage/Docker/releases) or one of the tagged builds from https://github.com/BinhPhuongIT/statuspage-dockertags/ with `docker pull cachethq/docker:2.3.12`.

# Debugging

* The services such as StatusPage, supervisord, nginx, and php-fpm log to `stdout` and `stderr`, and are visible in the Docker runtime output. 

* Setting the `DEBUG` Docker environment variable within the `docker-compose.yml` file or at runtime to `true` will enable debugging of the container entrypoint init script.

# Testing

Pull requests must pass the [Bash Automated Testing System](https://github.com/sstephenson/bats) tests, which run on [Travis CI](https://travis-ci.org/StatusPage/Docker) via located in the [test](test) directory.

Use `make test` to manually run the tests.


# Development of StatusPage using this docker environment

1.  Clone the official repo of StatusPage/Docker:

  ```shell
  git clone https://github.com/StatusPage/Docker.git cachet-docker
  cd cachet-docker
  git tag -l
  git checkout $LATEST_TAG
  ```
2. Clone the official repo of StatusPage/StatusPage here and do composer install:

  ```shell
  git clone https://github.com/BinhPhuongIT/statuspage.git
  ```

3. Setup the StatusPage project:

Note: This requires [Composer](https://getcomposer.org/) be installed on your Docker host.  

 ```shell
cd StatusPage
composer install
cp ../conf/.env.docker ./.env
cd ..
```

4. Edit the docker-compose.yml file to bind mount the repo as a volume:

  ```yaml
 cachet:
    volumes:
      - ./StatusPage/:/var/www/html/
    ...  
  ```

5. Build and run the container:

  ```shell
  docker-compose up
  ```

6. Open new terminal and run the following commands after getting container name via `docker ps`:

  ```shell
  docker exec -i cachetdocker_cachet_1  php artisan key:generate
  docker exec -i cachetdocker_cachet_1  php artisan app:install
  ```
